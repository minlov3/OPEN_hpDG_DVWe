function phy = reference_to_physical_cube ( t, n, ref )

%% the reference cube


phy = NaN(3,n);

for i = 1 : 3

    phy(i,1:n) = t(i,1) * ( (1 - ref(1,1:n)).*(1 - ref(2,1:n)).*(1 - ref(3,1:n)) ).*(1/8) ...
               + t(i,2) * ( (1 + ref(1,1:n)).*(1 - ref(2,1:n)).*(1 - ref(3,1:n)) ).*(1/8) ...
               + t(i,3) * ( (1 + ref(1,1:n)).*(1 - ref(2,1:n)).*(1 + ref(3,1:n)) ).*(1/8) ...
               + t(i,4) * ( (1 - ref(1,1:n)).*(1 - ref(2,1:n)).*(1 + ref(3,1:n)) ).*(1/8) ...
               + t(i,5) * ( (1 - ref(1,1:n)).*(1 + ref(2,1:n)).*(1 - ref(3,1:n)) ).*(1/8) ...
               + t(i,6) * ( (1 + ref(1,1:n)).*(1 + ref(2,1:n)).*(1 - ref(3,1:n)) ).*(1/8) ...
               + t(i,7) * ( (1 + ref(1,1:n)).*(1 + ref(2,1:n)).*(1 + ref(3,1:n)) ).*(1/8) ...
               + t(i,8) * ( (1 - ref(1,1:n)).*(1 + ref(2,1:n)).*(1 + ref(3,1:n)) ).*(1/8); ...
end

  return
end